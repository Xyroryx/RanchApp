<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reitstunden Plan</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, where } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyApbpJxOwiAep9U1dgd1VtSmbXJm44phAM",
      authDomain: "ranchapp-8eff2.firebaseapp.com",
      projectId: "ranchapp-8eff2",
      storageBucket: "ranchapp-8eff2.appspot.com",
      messagingSenderId: "662200775507",
      appId: "1:662200775507:web:63588f0221150f8fbb27a6",
      measurementId: "G-JDR6PNZ195"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const colRef = collection(db, "reitstunden");

    const form = document.getElementById("addForm");
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const schueler = document.getElementById("schueler").value;
      const wochentag = document.getElementById("wochentag").value;
      const datum = document.getElementById("datum").value;
      const typ = document.getElementById("typ").value;
      const notiz = document.getElementById("notiz").value;

      await addDoc(colRef, {
        schueler,
        wochentag,
        datum,
        typ,
        notiz
      });
      form.reset();
      anzeigen();
    });

    async function anzeigen() {
      const tableBody = document.getElementById("tabelleBody");
      tableBody.innerHTML = "";

      const snapshot = await getDocs(colRef);
      const daten = {};

      snapshot.forEach((doc) => {
        const d = doc.data();
        if (!daten[d.schueler]) daten[d.schueler] = {};
        if (!daten[d.schueler][d.wochentag]) daten[d.schueler][d.wochentag] = [];
        daten[d.schueler][d.wochentag].push({ ...d, id: doc.id });
      });

      Object.keys(daten).sort().forEach((name) => {
        const tr = document.createElement("tr");
        const tdName = document.createElement("td");
        tdName.textContent = name;
        tr.appendChild(tdName);

        ["Montag", "Dienstag", "Mittwoch", "Donnerstag", "Freitag", "Samstag", "Sonntag"].forEach((tag) => {
          const td = document.createElement("td");
          const eintraege = daten[name][tag] || [];
          eintraege.forEach(e => {
            const div = document.createElement("div");
            div.textContent = `${e.typ} - ${e.notiz}`;
            div.style.cursor = "pointer";
            div.onclick = async () => {
              if (confirm("Eintrag löschen?")) {
                await deleteDoc(doc(db, "reitstunden", e.id));
                anzeigen();
              }
            };
            td.appendChild(div);
          });
          tr.appendChild(td);
        });
        tableBody.appendChild(tr);
      });
    }

    window.onload = anzeigen;
  </script>
  <style>
    body {
      font-family: sans-serif;
      background: black;
      color: white;
      padding: 1rem;
    }
    input, select, button {
      display: block;
      margin: 0.5rem 0;
      width: 100%;
      padding: 0.5rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
      background: #111;
    }
    th, td {
      border: 1px solid #555;
      padding: 0.5rem;
      text-align: center;
    }
    th {
      background: #333;
    }
  </style>
</head>
<body>
  <h1>Reitstundenplan</h1>
  <form id="addForm">
    <input id="schueler" placeholder="Schülername" required />
    <select id="wochentag">
      <option>Montag</option><option>Dienstag</option><option>Mittwoch</option>
      <option>Donnerstag</option><option>Freitag</option><option>Samstag</option><option>Sonntag</option>
    </select>
    <input type="date" id="datum" required />
    <input id="notiz" placeholder="Pferd / Notiz" />
    <select id="typ">
      <option>Reitstunde</option>
      <option>Reitbeteiligung</option>
    </select>
    <button>Eintragen</button>
  </form>

  <table>
    <thead>
      <tr>
        <th>Schüler</th>
        <th>Montag</th>
        <th>Dienstag</th>
        <th>Mittwoch</th>
        <th>Donnerstag</th>
        <th>Freitag</th>
        <th>Samstag</th>
        <th>Sonntag</th>
      </tr>
    </thead>
    <tbody id="tabelleBody"></tbody>
  </table>
</body>
</html>