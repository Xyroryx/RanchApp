<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reitstunden Wochenplan</title>
  <link rel="icon" href="logo_v99.png" type="image/png">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      background: black;
      color: white;
    }
    header {
      text-align: center;
      padding: 1rem;
    }
    header img {
      max-height: 80px;
    }
    h1 {
      margin: 0.5rem 0;
    }
    form, .filter-container {
      background: #222;
      padding: 1rem;
      margin: 1rem;
      border-radius: 10px;
    }
    input, select, button {
      width: 100%;
      margin-top: 0.5rem;
      padding: 0.5rem;
      border-radius: 5px;
      border: none;
      background: #333;
      color: white;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #111;
      margin: 1rem;
    }
    th, td {
      border: 1px solid #555;
      padding: 0.7rem;
      text-align: center;
      color: white;
    }
    th {
      background: #333;
    }
    .highlight {
      background-color: #444;
    }
    .pdf-button {
      background: #007BFF;
      color: white;
      padding: 0.6rem;
      border: none;
      border-radius: 5px;
      margin-top: 1rem;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>
    <img src="logo_v99.png" alt="Logo">
    <h1>Reitstunden Übersicht</h1>
  </header>

  <form id="addForm">
    <label>Schülername:</label>
    <input type="text" id="schueler" required>

    <label>Wochentag:</label>
    <select id="wochentag">
      <option value="Montag">Montag</option>
      <option value="Dienstag">Dienstag</option>
      <option value="Mittwoch">Mittwoch</option>
      <option value="Donnerstag">Donnerstag</option>
      <option value="Freitag">Freitag</option>
      <option value="Samstag">Samstag</option>
      <option value="Sonntag">Sonntag</option>
    </select>

    <label>Tag (Zahl):</label>
    <input type="number" id="tag" min="1" max="31" required>

    <label>Monat:</label>
    <select id="monat">
      <option value="Januar">Januar</option>
      <option value="Februar">Februar</option>
      <option value="März">März</option>
      <option value="April">April</option>
      <option value="Mai">Mai</option>
      <option value="Juni">Juni</option>
      <option value="Juli">Juli</option>
      <option value="August">August</option>
      <option value="September">September</option>
      <option value="Oktober">Oktober</option>
      <option value="November">November</option>
      <option value="Dezember">Dezember</option>
    </select>

    <label>Notiz (Pferd etc.):</label>
    <input type="text" id="notiz">

    <button type="submit">Eintragen</button>
  </form>

  <div class="filter-container">
    <label for="monatFilter">Nach Monat filtern:</label>
    <select id="monatFilter" onchange="anzeigen()">
      <option value="">Alle</option>
    </select>
    <button class="pdf-button" onclick="exportPDF()">PDF exportieren</button>
  </div>

  <div id="printArea">
    <table>
      <thead>
        <tr id="headerRow">
          <th>Schüler</th>
        </tr>
      </thead>
      <tbody id="tabelleBody"></tbody>
    </table>
  </div>

  <script>
    let stunden = JSON.parse(localStorage.getItem('wochenplan')) || [];

    const speichern = () => {
      localStorage.setItem('wochenplan', JSON.stringify(stunden));
    };

    const exportPDF = () => {
      setTimeout(() => {
        const element = document.getElementById('printArea');
        const opt = {
          margin: 0.5,
          filename: 'reitstunden.pdf',
          image: { type: 'jpeg', quality: 0.98 },
          html2canvas: { scale: 2, backgroundColor: '#fff', useCORS: true },
          jsPDF: { unit: 'in', format: 'a4', orientation: 'landscape' }
        };
        html2pdf().from(element).set(opt).save();
      }, 300);
    };

    const extractMonate = () => {
      const set = new Set();
      stunden.forEach(e => set.add(e.monat));
      return Array.from(set);
    };

    const updateFilterDropdown = () => {
      const select = document.getElementById('monatFilter');
      const value = select.value;
      select.innerHTML = '<option value="">Alle</option>';
      extractMonate().sort().forEach(m => {
        const opt = document.createElement('option');
        opt.value = m;
        opt.textContent = m;
        if (m === value) opt.selected = true;
        select.appendChild(opt);
      });
    };

    const anzeigen = () => {
      const monatFilter = document.getElementById('monatFilter').value;
      const gefiltert = monatFilter ? stunden.filter(e => e.monat === monatFilter) : stunden;

      const schueler = [...new Set(gefiltert.map(e => e.schueler))].sort();
      const tage = [...new Set(gefiltert.map(e => `${e.wochentag} ${String(e.tag).padStart(2, '0')}. ${e.monat}`))];
      const sortReihenfolge = ['Montag','Dienstag','Mittwoch','Donnerstag','Freitag','Samstag','Sonntag'];

      tage.sort((a,b) => {
        const [wa,ta,ma] = a.split(' ');
        const [wb,tb,mb] = b.split(' ');
        const ai = sortReihenfolge.indexOf(wa);
        const bi = sortReihenfolge.indexOf(wb);
        if (ai !== bi) return ai - bi;
        return parseInt(ta) - parseInt(tb);
      });

      const headerRow = document.getElementById('headerRow');
      const tabelleBody = document.getElementById('tabelleBody');
      headerRow.innerHTML = '<th>Schüler</th>' + tage.map(t => `<th>${t}</th>`).join('') + '<th>Anzahl</th>';
      tabelleBody.innerHTML = '';

      schueler.forEach(s => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${s}</td>`;
        let count = 0;
        tage.forEach(t => {
          const [wochentag, tag, monat] = t.split(' ');
          const match = gefiltert.find(e => e.schueler === s && e.wochentag === wochentag && String(e.tag).padStart(2,'0')+ '.' === tag && e.monat === monat);
          if (match) {
            tr.innerHTML += `<td class='highlight' title="${match.notiz}">${match.notiz}</td>`;
            count++;
          } else {
            tr.innerHTML += `<td></td>`;
          }
        });
        tr.innerHTML += `<td>${count}</td>`;
        tabelleBody.appendChild(tr);
      });

      updateFilterDropdown();
    };

    document.getElementById('addForm').addEventListener('submit', e => {
      e.preventDefault();
      const eintrag = {
        schueler: document.getElementById('schueler').value.trim(),
        wochentag: document.getElementById('wochentag').value,
        tag: parseInt(document.getElementById('tag').value),
        monat: document.getElementById('monat').value,
        notiz: document.getElementById('notiz').value.trim()
      };
      stunden.push(eintrag);
      speichern();
      anzeigen();
      e.target.reset();
    });

    anzeigen();
  </script>
</body>
</html>